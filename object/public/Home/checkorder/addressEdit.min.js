!function(e){function r(i){if(t[i])return t[i].exports;var n=t[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,r),n.loaded=!0,n.exports}var t={};return r.m=e,r.c=t,r.p="",r(0)}([function(e,r,t){e.exports=t(1)},function(e,r,t){t(2),MI.addressEdit=function(){function e(e,r,t){var i=!1,n={regions:[]};if(addressConfig.addressMatchData&&"function"==typeof addressConfig.addressMatchData&&(i=addressConfig.addressMatchData()),i){var a=i.length;e=parseInt(e),t=parseInt(t);for(var s=0;a>s;s+=1)if(1===e)n.regions.push({region_id:i[s].id,region_name:i[s].name,zipcode:0});else for(var d=0;d<i[s].child.length;d+=1)if(i[s].id===e)n.regions.push({region_id:i[s].child[d].id,region_name:i[s].child[d].name,zipcode:0});else for(var c=0;c<i[s].child[d].child.length;c+=1)i[s].child[d].id===e&&n.regions.push({region_id:i[s].child[d].child[c].id,region_name:i[s].child[d].child[c].name,zipcode:i[s].child[d].child[c].zipcode?i[s].child[d].child[c].zipcode:""});MI.getRegions.formatData(n,r,t),"edit"===o&&t&&$("#"+r).trigger("change")}}function r(e){if(e.length){var r,t=e.attr("name"),i=$.trim(e.val());if("user_name"===t){if(r=/^[a-zA-Z\u4e00-\u9fa5·]+$/,i.length<2||i.length>20)return e.trigger("error",["收货人姓名，最少2个最多20个中文字"]),!1;if(!r.test(i))return e.trigger("error",["收货人姓名不正确（只能是英文、汉字）"]),!1;e.trigger("valid"),a.uname=i}else if("user_phone"===t){if(r=/^1[0-9]{10}$/,!r.test(i)&&"edit"!==o)return e.trigger("error",["请输入正确的手机号"]),!1;if("edit"===o&&""!==i&&!r.test(i))return e.trigger("error",["请输入正确的手机号"]),!1;e.trigger("valid"),a.phone=i}else if("user_adress"===t){i=i.replace(/</g,"").replace(/>/g,"").replace(/\//g,"").replace(/\\/g,""),r=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;var n=/^\d+$/,s=/^[0-9a-zA-Z]+$/;if(i.length<5||i.length>32)return e.trigger("error",["详细地址长度不对，最小为 5 个字，最大32个字"]),!1;if(r.test(i)||n.test(i)||s.test(i))return e.trigger("error",["详细地址不正确"]),!1;a.address=i}else if("user_zipcode"===t){if(r=/^\d{6}$/,!r.test(i))return e.trigger("error",["邮编是6位数字"]),!1;a.zipcode=i}else if("user_tag"===t){if(i.length>5)return e.trigger("error",["地址标签最长5个字"]),!1;a.tag=i}return!0}}function t(){$("#user_phone").attr("placeholder",addressConfig.fromAddress.tel),$("#user_adress").val(addressConfig.fromAddress.address).trigger("focus"),addressConfig.fromAddress.tag_name&&$("#user_tag").val(addressConfig.fromAddress.tag_name).trigger("focus"),$("#user_name").val(addressConfig.fromAddress.consignee).trigger("focus")}function i(){var e={consignee:a.uname,province_id:a.province,city_id:a.city,district_id:a.county,area:a.area,address:a.address,zipcode:a.zipcode,tel:a.phone,tag_name:a.tag};"edit"===o&&(e.address_id=addressConfig.addressId);var r=window.location.href;$.ajax({type:"POST",url:r,dataType:"json",data:{newAddress:e,risk_token:c},timeout:1e4,error:function(){},success:function(e){s&&e&&window.parent.editAddressCallback.save(e,o,a)}})}function n(e,r){var t=MI.GLOBAL_CONFIG.orderSite+"/api/getAddressRegion.php";if(e){d.regions=[];var i=r?r:"";$.ajax({url:t,dataType:"json",data:{parent:e},timeout:1e4,success:function(e){e&&1===e.code?($.each(e.data.regions,function(e,r){d.regions.push({region_id:r.region_id.toString(),region_name:r.region_name,zipcode:r.zipcode})}),MI.getRegions.formatData(d,"J_area",i),$("#J_area").trigger("change")):alert(e.msg)}})}}var a={},o="",s=null,d={regions:[]},c="",l=function(){MI.form.init(),o=g.getQueryString("action"),window.parent&&window.parent.editAddressCallback&&(s=window.parent.editAddressCallback),"edit"!==o&&e(1,"J_province"),$("#J_province").on("change",function(){var r=$(this).val();$("#J_county, #J_area").val("0").prop("disabled",!0),"0"!==r?(a.province=r,a.provinceName=$(this).find("option:selected").html(),$(this).parents(".xm-select").removeClass("xm-select-error"),"edit"===o?e(r,"J_city",addressConfig.fromAddress.city_id):e(r,"J_city")):(a.province=null,a.provinceName=null)}),$("#J_city").on("change",function(){var r=$(this).val();$("#J_area").val("0").prop("disabled",!0).find("options:gt(0)").remove(),"0"!==r?(a.city=r,a.cityName=$(this).find("option:selected").html(),$(this).parents(".xm-select").removeClass("xm-select-error"),"edit"===o?e(r,"J_county",addressConfig.fromAddress.district_id):e(r,"J_county")):(a.city=null,a.cityName=null)}),$("#J_county").on("change",function(){var e=$(this).val();"0"!==e?(a.county=e,a.countyName=$(this).find("option:selected").html(),a.zipcode=$(this).find("option:selected").attr("zipcode"),$(this).parents(".xm-select").removeClass("xm-select-error"),"edit"===o?n(e,addressConfig.fromAddress.area):n(e),a.zipcode&&$("#user_zipcode").trigger("focus").val(a.zipcode)):(a.county=null,a.countyName=null,a.zipcode=null)}),$("#J_area").parents(".xm-select").removeClass("hide").parent().addClass("form-select-2"),$("#J_area").on("change",function(){var e=$(this).val();"0"!==e?(a.area=e,a.areaName=$(this).find("option:selected").html(),$(this).parents(".xm-select").removeClass("xm-select-error")):a.area=null}),s&&"edit"===o&&(addressConfig.fromAddress=s.getAddress(),e(1,"J_province",addressConfig.fromAddress.province_id),t(),"Y"===addressConfig.fromAddress.neededit&&$("#J_addressSuppTip").removeClass("hide")),$("#J_save").on("click",function(){var e=!1;$(".J_addressInput").each(function(){return e=r($(this)),e?void 0:!1}),$(".xm-select").each(function(){return"0"===$(this).find("select").val()?(e=!1,$(this).addClass("xm-select-error"),!0):void 0}),e&&a.province&&a.city&&a.county&&a.area&&(i(),"edit"!==o||a.phone||(a.phone=addressConfig.fromAddress.tel))}),$("#J_cancel").on("click",function(){s&&s.cancel()});var d=g.getQueryString("hastv");"true"===d&&$("#user_name").attr("placeholder","收货时将核对身份证信息").siblings("label").html("真实姓名"),c=window.parent.getUserTiskToken()},g={getQueryString:function(e){var r=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(r);return null!==t?decodeURIComponent(t[2]):null}};return{init:l}}(),$(document).ready(function(){MI.addressEdit.init()})},function(e,r){MI.getRegions={getUrl:"/region/index",getData:function(e,r,t){var i=this;$.ajax({type:"GET",url:i.getUrl,data:"parent="+e,dataType:"json",success:function(e){e&&i.formatData(e,r,t)}})},formatData:function(e,r,t){for(var i=e.regions,n=i.length,a=$("#"+r),o='<option value="0">'+a.children("option").eq(0).html()+"</option>",s=0;n>s;s+=1){var d=i[s].region_id===t?"selected":"";o+='<option zipcode="'+i[s].zipcode+'" value="'+i[s].region_id+'"'+d+">"+i[s].region_name+"</option>"}$("#"+r).html(o).prop("disabled",!1)}}}]);